(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     49697,       1222]
NotebookOptionsPosition[     48373,       1180]
NotebookOutlinePosition[     48710,       1195]
CellTagsIndexPosition[     48667,       1192]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"normalize", "[", "lst_", "]"}], " ", ":=", " ", 
    RowBox[{"lst", "/", 
     RowBox[{"Total", "[", "lst", "]"}]}]}], ";"}], " ", "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"forward", "[", 
     RowBox[{"f_", ",", "A_", ",", "Bs_"}], "]"}], " ", ":=", " ", 
    RowBox[{"FoldList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#1", ".", 
        RowBox[{"Transpose", "[", "A", "]"}], ".", "#2"}], " ", "&"}], ",", 
      "f", ",", "Bs"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"backward", "[", 
     RowBox[{"b_", ",", "A_", ",", "Bs_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Reverse", "[", 
     RowBox[{"FoldList", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"normalize", "[", 
         RowBox[{"A", ".", "#2", ".", "#1"}], "]"}], " ", "&"}], ",", "b", 
       ",", 
       RowBox[{"Reverse", "[", "Bs", "]"}]}], "]"}], "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"likelihood", "[", 
    RowBox[{"f_", ",", "A_", ",", "Bs_"}], "]"}], " ", ":=", "  ", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#1", " ", "+", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"Total", "[", "#2", "]"}], "]"}]}], " ", "&"}], ",", "0", ",", 
     RowBox[{"forward", "[", 
      RowBox[{"f", ",", "A", ",", "Bs"}], "]"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"forwardBackward", "[", 
     RowBox[{"fInit_", ",", "A_", ",", "Bs_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"f", ",", "b", ",", "likelihood"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"forward", "[", 
         RowBox[{"fInit", ",", "A", ",", "Bs"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"normalize", " ", "/@", " ", 
         RowBox[{"backward", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{"1", ",", 
             RowBox[{"{", 
              RowBox[{"Length", "[", "fInit", "]"}], "}"}]}], "]"}], ",", "A",
            ",", "Bs"}], "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"likelihood", " ", "=", " ", 
        RowBox[{"Fold", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#1", " ", "+", " ", 
            RowBox[{"Log", "[", 
             RowBox[{"Total", "[", "#2", "]"}], "]"}]}], " ", "&"}], ",", "0",
           ",", "f"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"f", " ", 
        RowBox[{"normalize", " ", "/@", " ", "f"}]}], ";", "\n", "\t", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"f", ",", "b", ",", "likelihood"}], "}"}], "]"}], ";"}]}], 
     "\n", "\t", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"normalize", "[", 
           RowBox[{"Times", " ", "@@", " ", "#"}], "]"}], " ", "&"}], " ", "/@",
          " ", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"f", ",", "b"}], "}"}], "]"}]}], "]"}], ";"}], "*)"}], 
     "\n", "]"}]}], ";"}], "\n", "\n"}], "\n", 
 RowBox[{
  RowBox[{"A", "  ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.7", ",", "0.3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.3", ",", "0.7"}], "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"U", "  ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.9", ",", "0.0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.0", ",", "0.2"}], "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"NU", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.1", ",", "0.0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.0", ",", "0.8"}], "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Bs", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"U", ",", "U", ",", "NU", ",", "U", ",", "U"}], "}"}]}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.5284641355616913`*^9, 3.5284641491799603`*^9}, {
   3.5284650214962673`*^9, 3.528465107921493*^9}, {3.528465146332836*^9, 
   3.52846514708762*^9}, 3.528465234505928*^9, {3.528465328905599*^9, 
   3.528465453050489*^9}, 3.528465494618013*^9, {3.528465672040279*^9, 
   3.528465732579588*^9}, {3.528465810246277*^9, 3.528465860112893*^9}, {
   3.5284659139934072`*^9, 3.528465919918467*^9}, {3.528465958954472*^9, 
   3.528466028210794*^9}, {3.528466072546726*^9, 3.528466104322671*^9}, {
   3.5284661613713417`*^9, 3.5284662184892893`*^9}, {3.528466253132782*^9, 
   3.528466328074122*^9}, {3.528466358254092*^9, 3.5284664392303457`*^9}, {
   3.528466521035717*^9, 3.52846662343041*^9}, {3.528466670390461*^9, 
   3.5284666900520573`*^9}, {3.528466744509898*^9, 3.528466831514523*^9}, {
   3.528466874561318*^9, 3.52846687769396*^9}, {3.528466938019751*^9, 
   3.5284670013321877`*^9}, {3.528467062493482*^9, 3.5284670629040947`*^9}, {
   3.5284671837825603`*^9, 3.528467196885888*^9}, {3.5284672381204157`*^9, 
   3.528467242957307*^9}, 3.52847096586987*^9, {3.5285189726589737`*^9, 
   3.528519012771215*^9}, {3.528519050446576*^9, 3.5285191473012342`*^9}, {
   3.528519210435738*^9, 3.528519322044531*^9}, {3.528522612028235*^9, 
   3.528522654678581*^9}, {3.528526257124495*^9, 3.528526273171452*^9}, {
   3.528529163289345*^9, 3.528529195026369*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"forward", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.5"}], "}"}], ",", "A", ",", "Bs"}], "]"}]], "Input",\

 CellChangeTimes->{{3.528465150039711*^9, 3.528465180297514*^9}, {
   3.528465461893564*^9, 3.528465463983912*^9}, {3.528465570285524*^9, 
   3.528465571127304*^9}, {3.5284656153035707`*^9, 3.52846563469055*^9}, {
   3.528465700125765*^9, 3.5284657238972893`*^9}, {3.5284662324612303`*^9, 
   3.5284662343563557`*^9}, {3.528466696717483*^9, 3.5284666984368343`*^9}, {
   3.528466844448278*^9, 3.528466845295163*^9}, {3.5284670944553547`*^9, 
   3.5284671208068542`*^9}, {3.528467577221705*^9, 3.528467578267536*^9}, 
   3.528470965871664*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0.5`", ",", "0.5`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.8181818181818181`", ",", "0.18181818181818182`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.883357041251778`", ",", "0.11664295874822192`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.19066793972352525`", ",", "0.8093320602764749`"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"0.730794004584982`", ",", "0.26920599541501794`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0.8673388895754847`", ",", "0.13266111042451528`"}], "}"}]}], 
    "}"}], ",", 
   RowBox[{"-", "10.01820140738153`"}]}], "}"}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{
  3.528465181879077*^9, {3.5284652390544252`*^9, 3.528465247022752*^9}, 
   3.528465464636085*^9, {3.528465498423481*^9, 3.528465501328002*^9}, 
   3.52846557150353*^9, {3.5284656181879053`*^9, 3.528465635608803*^9}, {
   3.528465684770136*^9, 3.528465738020896*^9}, 3.528465830138688*^9, 
   3.528466235020639*^9, {3.528466275529911*^9, 3.528466332290831*^9}, 
   3.528466376297246*^9, 3.528466444486231*^9, 3.528466698981825*^9, 
   3.5284668458020353`*^9, 3.528466881277864*^9, 3.5284669486105547`*^9, {
   3.528466986144849*^9, 3.5284670054921913`*^9}, 3.52846712153871*^9, 
   3.528467201644012*^9, {3.5284672567817698`*^9, 3.528467261111184*^9}, 
   3.5284675796473837`*^9, 3.528470965873672*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findCalcB", "[", 
     RowBox[{"mu_", ",", " ", "sigma_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Function", "[", 
     RowBox[{"frame", ",", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"PDF", "[", 
          RowBox[{
           RowBox[{"MultinormalDistribution", "[", 
            RowBox[{
             RowBox[{"mu", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"sigma", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", "frame"}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "mu", "]"}]}], "}"}]}], "]"}], "]"}]}], 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"newModel", "[", 
     RowBox[{"A_", ",", "calcB_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Function", "[", 
     RowBox[{"frames", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"forward", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{"0.5", ",", 
            RowBox[{"Length", "[", "A", "]"}]}], "]"}], ",", "A", ",", 
          RowBox[{"calcB", " ", "/@", " ", "frames"}]}], "]"}], ")"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"addModel", "[", 
     RowBox[{"classifier_", ",", "word_", ",", "model_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Append", "[", 
     RowBox[{"classifier", ",", 
      RowBox[{"{", 
       RowBox[{"word", ",", "model"}], "}"}]}], "]"}]}], ";"}], "\n"}], "\n", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"emInit", "[", 
     RowBox[{"Os_", ",", " ", "N_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "A", ",", "prior", ",", " ", "mu", ",", " ", "sigma", ",", "D", ",", 
        "mean"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"D", " ", "=", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"Os", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"Generate", " ", "a", " ", "random", " ", "prior"}], " ", 
        "*)"}], "\n", "\t", 
       RowBox[{"prior", " ", "=", " ", 
        RowBox[{"normalize", "[", 
         RowBox[{"RandomReal", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0.01", ",", " ", "0.99"}], "}"}], ",", "N"}], "]"}], 
         "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Generate", " ", "a", " ", "random", " ", "transition", " ", "matrix",
          " ", "A"}], " ", "*)"}], "\n", "\t", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"normalize", " ", "/@", " ", 
         RowBox[{"(", 
          RowBox[{"RandomReal", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0.01", ",", " ", "0.99"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"N", ",", "N"}], "}"}]}], "]"}], ")"}]}]}], ";", "\n", 
       "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"mu", ",", " ", 
         RowBox[{"for", " ", "each", " ", "state"}]}], " ", "*)"}], "\n", 
       "\t", 
       RowBox[{"mu", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0.01", ",", "0.99"}], "}"}], "]"}], " ", "*", " ", 
             RowBox[{"Mean", "[", "#", "]"}]}], " ", "&"}], " ", "/@", " ", 
           RowBox[{"Transpose", "[", "Os", "]"}]}], ",", 
          RowBox[{"{", "N", "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"(*", " ", 
        RowBox[{"sigma", ",", " ", 
         RowBox[{"for", " ", "each", " ", "state"}]}], " ", "*)"}], "\n", 
       "\t", 
       RowBox[{"sigma", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", ".", 
             RowBox[{"Transpose", "[", "#", "]"}]}], " ", "&"}], "[", 
           RowBox[{"RandomReal", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.01", ",", "0.99"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"D", ",", "D"}], "}"}]}], "]"}], "]"}], ",", 
          RowBox[{"{", "N", "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"prior", ",", "A", ",", "mu", ",", "sigma", ",", "Os"}], 
         "}"}], "]"}], ";"}]}], "\n", "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"estimateGamma", "[", "xi_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"gamma", ",", "j", ",", "t", ",", "i"}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{
       RowBox[{"gamma", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "xi", "]"}], " ", "+", " ", "1"}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", 
            RowBox[{"xi", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "}"}]}], "]"}]}], ";", 
       "\n", "\t", 
       RowBox[{"Print", "[", "xi", "]"}], ";", "\n", "\t", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"t", " ", "=", " ", "1"}], ",", " ", 
         RowBox[{"t", " ", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", "xi", "]"}]}], ",", " ", 
         RowBox[{"t", "++"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
            RowBox[{"i", " ", "\[LessEqual]", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"xi", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
            RowBox[{"i", "++"}], ",", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", " ", "=", " ", "1"}], ",", " ", 
               RowBox[{"j", " ", "\[LessEqual]", " ", 
                RowBox[{"Length", "[", 
                 RowBox[{"xi", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{"j", "++"}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"gamma", "[", 
                  RowBox[{"[", 
                   RowBox[{"t", ",", "i"}], "]"}], "]"}], " ", "=", " ", 
                 RowBox[{
                  RowBox[{"gamma", "[", 
                   RowBox[{"[", 
                    RowBox[{"t", ",", "i"}], "]"}], "]"}], " ", "+", " ", 
                  RowBox[{"xi", "[", 
                   RowBox[{"[", 
                    RowBox[{"t", ",", "i", ",", "j"}], "]"}], "]"}]}]}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";"}]}], "\n", "\t\t", "]"}], 
          ";"}]}], "\n", "\t", "]"}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", " ", "=", " ", "1"}], ",", " ", 
         RowBox[{"j", " ", "\[LessEqual]", "  ", 
          RowBox[{"Length", "[", 
           RowBox[{"xi", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
         RowBox[{"j", "++"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"For", "[", " ", 
           RowBox[{
            RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
            RowBox[{"i", " ", "<", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"xi", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", " ", 
            RowBox[{"i", "++"}], ",", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"gamma", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", "xi", "]"}], " ", "+", " ", "1"}], 
                 ",", "j"}], "]"}], "]"}], " ", "=", " ", 
              RowBox[{
               RowBox[{"gamma", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "xi", "]"}], " ", "+", " ", "1"}], 
                  ",", "j"}], "]"}], "]"}], " ", "+", " ", 
               RowBox[{"xi", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"Length", "[", "xi", "]"}], ",", "i", ",", "j"}], 
                 "]"}], "]"}]}]}], ";"}]}], "\n", "\t\t", "]"}], ";"}]}], 
        "\n", "\t", "]"}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{"Return", "[", "gamma", "]"}], ";"}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"estimateXi", "[", 
     RowBox[{"Os_", ",", "A_", ",", "calcB_", ",", 
      RowBox[{"{", 
       RowBox[{"f_", ",", "b_", ",", "prob_"}], "}"}]}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Table", "[", "\n", "\t\t", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"A", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", "*", " ", 
         RowBox[{"f", "[", 
          RowBox[{"[", 
           RowBox[{"t", ",", "i"}], "]"}], "]"}], " ", "*", " ", 
         RowBox[{"b", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"t", "+", "1"}], ",", "j"}], "]"}], "]"}], " ", "*", " ", 
         
         RowBox[{
          RowBox[{"calcB", "[", 
           RowBox[{"Os", "[", 
            RowBox[{"[", "t", "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"j", ",", "j"}], "]"}], "]"}]}], ")"}], " ", "/", " ", 
       "prob"}], ",", "\n", "\t\t", 
      RowBox[{"{", 
       RowBox[{"t", ",", "2", ",", 
        RowBox[{"Length", "[", "Os", "]"}]}], "}"}], ",", "\n", "\t\t", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "[", "A", "]"}]}], "}"}], ",", "\n", "\t\t", 
      RowBox[{"{", 
       RowBox[{"j", ",", "1", ",", 
        RowBox[{"Length", "[", "A", "]"}]}], "}"}]}], "\n", "]"}]}], ";"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fitPdf", "[", 
     RowBox[{"Os_", ",", "weights_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "mu", ",", "sigma", ",", "omm", ",", "obs", ",", "i", ",", "r", ",", 
        "c", ",", "j"}], "}"}], ",", "\n", "\t", 
      RowBox[{
       RowBox[{"D", " ", "=", " ", 
        RowBox[{"Length", "[", 
         RowBox[{"Os", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"mu", " ", "=", " ", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Fold", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", " ", "+", " ", 
               RowBox[{
                RowBox[{"#2", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "r"}], "]"}], "]"}], " ", "*", " ", 
                RowBox[{"#2", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}]}], " ", "&"}], ",", "0", 
             ",", 
             RowBox[{"Transpose", "[", 
              RowBox[{"{", 
               RowBox[{"Os", ",", "weights"}], "}"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"r", ",", "D"}], "}"}]}], "]"}], "\n", "\n", "\t", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
           RowBox[{"i", " ", "\[LessEqual]", " ", 
            RowBox[{"Length", "[", "Os", "]"}]}], ",", " ", 
           RowBox[{"i", "++"}], ",", "\n", "\t\t", 
           RowBox[{
            RowBox[{"obs", " ", "=", " ", 
             RowBox[{"Os", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\n", "\t\t", 
            RowBox[{"omm", " ", "=", " ", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"obs", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], " ", "-", " ", 
                RowBox[{"mu", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ",", 
               RowBox[{"Length", "[", "obs", "]"}]}], "]"}]}], ";", "\n", 
            "\n", "\t\t", 
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"r", " ", "=", " ", "1"}], ",", " ", 
              RowBox[{"r", " ", "\[LessEqual]", " ", "D"}], ",", " ", 
              RowBox[{"r", "++"}], ",", "\n", "\t\t\t", 
              RowBox[{
               RowBox[{"For", "[", 
                RowBox[{
                 RowBox[{"c", " ", "=", " ", "1"}], ",", " ", 
                 RowBox[{"c", " ", "<=", " ", "D"}], ",", " ", 
                 RowBox[{"c", "++"}], ",", "\n", "\t\t\t\t", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"sigma", "[", 
                    RowBox[{"[", 
                    RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
                   RowBox[{
                    RowBox[{"sigma", "[", 
                    RowBox[{"[", 
                    RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "+", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"omm", "[", "r", "]"}], " ", "*", " ", 
                    RowBox[{"omm", "[", "c", "]"}], " ", "*", " ", 
                    RowBox[{"weights", "[", "i", "]"}]}], ")"}]}]}], ";"}]}], 
                "\n", "\t\t\t", "]"}], ";"}]}], "\n", "\t\t", "]"}], ";"}]}], 
          "\n", "\t", "]"}]}]}], ";", "\n", "\t", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"mu", ",", " ", "sigma"}], "}"}], "]"}], ";"}]}], "\n", 
     "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"emStep", "[", 
     RowBox[{"{", 
      RowBox[{"prior_", ",", "A_", ",", "mu_", ",", "sigma_", ",", "Os_"}], 
      "}"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "T", ",", "gamma", ",", "xi", ",", "Aden", ",", "Anum", ",", "i", ",", 
        "j", ",", "t", ",", "calcB", ",", "fb", ",", "newPi", ",", "newA", 
        ",", "newMu", ",", "newSigma", ",", "weights"}], "}"}], ",", "\n", 
      "\t", 
      RowBox[{"(*", " ", 
       RowBox[{"Do", " ", "step"}], " ", "*)"}], " ", "\n", "\t", 
      RowBox[{
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"Length", "[", "Os", "]"}]}], ";", "\n", "\t", 
       RowBox[{"Anum", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", "T", "}"}], ",", 
          RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"Aden", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", "T", "}"}]}], "]"}]}], ";", "\n", "\n", "\t", 
       RowBox[{"calcB", " ", "=", " ", 
        RowBox[{"findCalcB", "[", 
         RowBox[{"mu", ",", "sigma"}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"fb", " ", "=", " ", 
        RowBox[{"forwardBackward", "[", 
         RowBox[{"prior", ",", "A", ",", 
          RowBox[{"calcB", " ", "/@", " ", "Os"}]}], "]"}]}], ";", "\n", "\t", 
       RowBox[{"xi", " ", "=", " ", 
        RowBox[{"estimateXi", "[", 
         RowBox[{"Os", ",", "A", ",", "calcB", ",", "fb"}], "]"}]}], ";", 
       "\n", "\t", "\n", "\t", 
       RowBox[{"gamma", " ", "=", " ", 
        RowBox[{"estimateGamma", "[", "xi", "]"}]}], ";", "\n", "\t", "\n", 
       "\t", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
         RowBox[{"i", " ", "\[LessEqual]", "  ", 
          RowBox[{"Length", "[", "A", "]"}]}], ",", " ", 
         RowBox[{"i", "++"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"t", " ", "=", " ", "1"}], ",", " ", 
            RowBox[{
             RowBox[{"t", " ", "<", " ", 
              RowBox[{"Length", "[", "Os", "]"}]}], ";", " ", 
             RowBox[{"t", "++"}]}], ",", "\n", "\t\t\t", 
            RowBox[{
             RowBox[{
              RowBox[{"Aden", "[", 
               RowBox[{"[", "i", "]"}], "]"}], " ", "=", " ", 
              RowBox[{
               RowBox[{"Aden", "[", 
                RowBox[{"[", "i", "]"}], "]"}], " ", "+", " ", 
               RowBox[{"gamma", "[", 
                RowBox[{"[", 
                 RowBox[{"t", ",", "i"}], "]"}], "]"}]}]}], ";", "\t\t", "\n",
              "\t\t\t", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"j", " ", "=", " ", "1"}], ",", " ", 
               RowBox[{"j", " ", "\[LessEqual]", " ", 
                RowBox[{"Length", "[", "A", "]"}]}], ",", " ", 
               RowBox[{"j", "++"}], ",", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"Anum", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", "=", " ", 
                 RowBox[{
                  RowBox[{"Anum", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", "+", " ", 
                  RowBox[{"xi", "[", 
                   RowBox[{"[", 
                    RowBox[{"t", ",", "i", ",", "j"}], "]"}], "]"}]}]}], 
                ";"}]}], "\n", "\t\t\t", "]"}], ";"}]}], "\n", "\t\t", "]"}], 
          ";"}]}], "\n", "\t", "]"}], ";", "\n", "\t", "\n", "\t", 
       RowBox[{"newA", " ", "=", " ", 
        RowBox[{"Table", "[", "\n", "\t\t", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Aden", "[", 
              RowBox[{"[", "i", "]"}], "]"}], " ", "\[Equal]", " ", "0"}], 
            ",", "\n", "\t\t\t", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"A", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "            ", ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "[", "A", "]"}]}], "}"}]}], "]"}], ",", 
            "\n", "\t\t\t", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"A", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", "/", " ", 
               RowBox[{"Aden", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "[", "A", "]"}]}], "}"}]}], "]"}]}], "\n", 
           "\t\t", "]"}], ",", "\n", "\t\t", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "A", "]"}]}], "}"}]}], "\n", "\t", "]"}]}],
        ";", "\t", "\n", "\t", 
       RowBox[{"(*", "\n", "\t", 
        RowBox[{
         RowBox[{"newPi", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"gamma", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "i"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "A", "]"}]}], "}"}]}], "]"}]}], ";", 
         "\n", "\n", "\t", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
           RowBox[{"i", " ", "\[LessEqual]", " ", 
            RowBox[{"Length", "[", "A", "]"}]}], ",", " ", 
           RowBox[{"i", "++"}], ",", "\n", "\t\t", 
           RowBox[{
            RowBox[{"weights", " ", "=", " ", 
             RowBox[{"normalize", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"gamma", "[", 
                 RowBox[{"[", 
                  RowBox[{"t", ",", "i"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"t", ",", 
                  RowBox[{"Length", "[", "Os", "]"}]}], "}"}]}], "]"}], 
              "]"}]}], ";", "\t\t", "\n", "\t\t", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"newMu", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"newSigma", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}], " ", "=", " ", 
             RowBox[{"fitPdf", "[", 
              RowBox[{"Os", ",", "weights"}], "]"}]}], ";"}]}], "\n", "\t", 
          "]"}], ";"}], "\n", "\t", "*)"}], "\n", "\t", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
         "newPi", ",", "newA", ",", "newMu", ",", "newSigma", ",", "Os"}], 
         "}"}], "]"}], ";"}]}], "\n", "]"}]}], ";"}], "\n", "\n", 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"baumWelch", "[", 
    RowBox[{"frames_", ",", "N_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "pi", ",", "A", ",", "mu", ",", "sigma", ",", "diff", ",", 
       "lastLikelihood"}], "}"}], ",", "\n", "\t", 
     RowBox[{
      RowBox[{"diff", " ", "=", " ", "0.00001"}], ";", "\n", "\t", 
      RowBox[{"lastLikelihood", " ", "=", " ", "0"}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"testConvergence", "[", 
        RowBox[{"{", 
         RowBox[{"pi_", ",", "A_", ",", "mu_", ",", "sigma_", ",", "Os_"}], 
         "}"}], "]"}], " ", ":=", " ", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"logLike", ",", "continue"}], "}"}], ",", "\n", "\t\t", 
         RowBox[{
          RowBox[{"logLike", " ", "=", " ", 
           RowBox[{"likelihood", "[", 
            RowBox[{"pi", ",", "A", ",", 
             RowBox[{
              RowBox[{"findCalcB", "[", 
               RowBox[{"mu", ",", "sigma"}], "]"}], " ", "/@", " ", "Os"}]}], 
            "]"}]}], ";", "\n", "\t\t", 
          RowBox[{"continue", " ", "=", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"logLike", " ", "-", " ", "lastLikelihood"}], ")"}], " ",
             "<", " ", "diff"}]}], ";", " \t\t", "\n", "\t\t", 
          RowBox[{"lastLikelihood", " ", "=", " ", "logLike"}], ";", "\n", 
          "\t\t", 
          RowBox[{"Return", "[", "continue", "]"}], ";"}]}], "\n", "\t", 
        "]"}]}], ";", "\n", "\t", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pi", ",", "A", ",", "mu", ",", "sigma", ",", "frames"}], 
        "}"}], " ", "=", " ", 
       RowBox[{"Nest", "[", 
        RowBox[{"emStep", ",", 
         RowBox[{"{", 
          RowBox[{"emInit", "[", 
           RowBox[{"frames", ",", "N"}], "]"}], "}"}], ",", 
         "testConvergence"}], "]"}]}], ";", "\n", "\t", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"A", ",", "mu", ",", "sigma"}], "}"}], "]"}], ";"}]}], "\n", 
    "]"}]}], ";"}], "\n", 
 RowBox[{"\t"}]}], "Code",
 CellChangeTimes->{{3.5284643215874023`*^9, 3.528464367155505*^9}, {
   3.5284647836614027`*^9, 3.528464784117384*^9}, {3.528464827103026*^9, 
   3.528464827480221*^9}, {3.5284651415887337`*^9, 3.528465142602221*^9}, {
   3.5284673460565023`*^9, 3.5284674611407948`*^9}, {3.5284675441262817`*^9, 
   3.528467583784881*^9}, {3.528467622863676*^9, 3.5284676462026787`*^9}, {
   3.528468541013771*^9, 3.528468611593236*^9}, {3.5284697780698423`*^9, 
   3.528469816019204*^9}, {3.528469852736714*^9, 3.5284702725153017`*^9}, {
   3.528470312222271*^9, 3.528470372715542*^9}, {3.5284704750256557`*^9, 
   3.528470564079028*^9}, {3.5284706161590443`*^9, 3.5284710183383617`*^9}, {
   3.528471059885613*^9, 3.528471094826582*^9}, {3.528471126944384*^9, 
   3.5284711314904346`*^9}, {3.52847124650828*^9, 3.528471882285986*^9}, {
   3.5284719891127577`*^9, 3.528472024167719*^9}, {3.528472086223473*^9, 
   3.5284720902389812`*^9}, {3.528472137808695*^9, 3.5284721399674263`*^9}, 
   3.528472184837594*^9, {3.528472343817004*^9, 3.528472368472747*^9}, {
   3.528472439200349*^9, 3.5284724780290728`*^9}, {3.5284725431334057`*^9, 
   3.528472547844396*^9}, {3.5284727114511347`*^9, 3.528472787245296*^9}, {
   3.52847289101145*^9, 3.528473066280705*^9}, {3.5284731296191483`*^9, 
   3.5284732107013893`*^9}, {3.528473241670114*^9, 3.5284733519018908`*^9}, {
   3.528473422166746*^9, 3.52847342231474*^9}, {3.5284734880323133`*^9, 
   3.528473490570602*^9}, {3.528473539138309*^9, 3.5284735760701313`*^9}, {
   3.528473618392252*^9, 3.528474140304696*^9}, {3.528474180302877*^9, 
   3.528474186820485*^9}, {3.528474249611058*^9, 3.528474366856411*^9}, {
   3.528474411659462*^9, 3.528474435880466*^9}, {3.528474471695754*^9, 
   3.528474503774836*^9}, {3.5284745471280212`*^9, 3.528474669778159*^9}, {
   3.52847473630236*^9, 3.528475101126464*^9}, {3.528475143107142*^9, 
   3.528475189280572*^9}, {3.5284752213638353`*^9, 3.528475305899475*^9}, {
   3.528475414445208*^9, 3.5284754165313463`*^9}, {3.5284754850202637`*^9, 
   3.528475543083788*^9}, {3.528475604286025*^9, 3.528475646769153*^9}, {
   3.5284756985238533`*^9, 3.528475815505025*^9}, {3.528475889637979*^9, 
   3.5284759916524773`*^9}, {3.528476123088107*^9, 3.5284761828695793`*^9}, {
   3.528476317497603*^9, 3.528476349912757*^9}, {3.528476397214714*^9, 
   3.528476503984029*^9}, {3.5284765466007633`*^9, 3.528476605779242*^9}, {
   3.5284766609872713`*^9, 3.5284768464223337`*^9}, {3.528476903039845*^9, 
   3.5284769229810963`*^9}, {3.528476953191127*^9, 3.5284769668505983`*^9}, {
   3.528477038783506*^9, 3.5284771251137943`*^9}, {3.5284771986272907`*^9, 
   3.528477200186459*^9}, {3.5285194391104803`*^9, 3.528519824514439*^9}, {
   3.528519860655216*^9, 3.528519872146956*^9}, {3.5285199200755577`*^9, 
   3.528519966133605*^9}, {3.528520003215228*^9, 3.528520008870281*^9}, {
   3.528520079724893*^9, 3.5285202915315447`*^9}, {3.52852032473308*^9, 
   3.528520416797536*^9}, {3.528520491821548*^9, 3.528520596162504*^9}, {
   3.5285206418056383`*^9, 3.528520766752233*^9}, {3.528520818219761*^9, 
   3.528520953535207*^9}, {3.528520987423252*^9, 3.52852147298424*^9}, {
   3.5285215167706614`*^9, 3.52852155809624*^9}, {3.5285216078271627`*^9, 
   3.528522502605398*^9}, {3.52852274516821*^9, 3.528522956308982*^9}, {
   3.528523108613533*^9, 3.528523132439752*^9}, {3.52852324150143*^9, 
   3.528523276936351*^9}, {3.528523361461187*^9, 3.528523414673038*^9}, {
   3.5285234585059032`*^9, 3.528523519833885*^9}, {3.528523669574368*^9, 
   3.528523713205598*^9}, 3.528523748022893*^9, {3.5285238217261467`*^9, 
   3.528523824088479*^9}, {3.5285238739573183`*^9, 3.5285238879665213`*^9}, {
   3.528523924972815*^9, 3.52852398769589*^9}, 3.52852402624209*^9, {
   3.528524057162772*^9, 3.5285241459578733`*^9}, {3.52852428563717*^9, 
   3.528524314003756*^9}, {3.5285243647452803`*^9, 3.528524371240945*^9}, {
   3.528524444069858*^9, 3.52852444600488*^9}, {3.528524542922484*^9, 
   3.528524545708006*^9}, {3.528524798682201*^9, 3.52852480751403*^9}, 
   3.5285253525756474`*^9, {3.528525387645269*^9, 3.5285254015596533`*^9}, {
   3.528525533817253*^9, 3.528525554746943*^9}, {3.528525718407537*^9, 
   3.528525718538048*^9}, {3.528526329474106*^9, 3.5285263444471397`*^9}, {
   3.5285263931416073`*^9, 3.528526401673882*^9}, {3.5285265091337147`*^9, 
   3.5285265092734737`*^9}, {3.528527061419282*^9, 3.528527081880939*^9}, {
   3.528527128137108*^9, 3.528527155352069*^9}, {3.528527240057516*^9, 
   3.528527402402594*^9}, {3.5285275958323097`*^9, 3.5285277926559*^9}, {
   3.52852792423741*^9, 3.5285279316015377`*^9}, {3.528527963745925*^9, 
   3.528528002320827*^9}, {3.528528162302772*^9, 3.528528241327799*^9}, {
   3.528528299462029*^9, 3.52852830907277*^9}, {3.528528339963991*^9, 
   3.528528381363916*^9}, {3.528528412656885*^9, 3.5285284222325897`*^9}, {
   3.528528494389263*^9, 3.52852851325807*^9}, {3.528528573998884*^9, 
   3.528528762628027*^9}, {3.528528793990863*^9, 3.528528845649197*^9}, {
   3.528528887699497*^9, 3.528528890945325*^9}, {3.528528929838415*^9, 
   3.5285289435881453`*^9}, {3.528529026793954*^9, 3.528529029634884*^9}, {
   3.528529100561862*^9, 3.5285291074102716`*^9}, 3.528529241184185*^9, {
   3.528529286664797*^9, 3.5285292952186737`*^9}, {3.5285294432625217`*^9, 
   3.5285294433957367`*^9}, {3.528529535272018*^9, 3.528529539581017*^9}, {
   3.528529693632889*^9, 3.5285297109017487`*^9}, {3.528529844646577*^9, 
   3.528529907286784*^9}, {3.5285299477563066`*^9, 3.5285300091435747`*^9}, {
   3.528530065813591*^9, 3.528530066348538*^9}, {3.52853037909035*^9, 
   3.528530391732107*^9}, {3.528530591775074*^9, 3.528530640182703*^9}, {
   3.528530685008542*^9, 3.528530703993791*^9}, {3.5285308264903803`*^9, 
   3.528530847021874*^9}, {3.52853088840097*^9, 3.528530994567041*^9}, {
   3.5285310354800663`*^9, 3.528531189078878*^9}, {3.5285312501044273`*^9, 
   3.528531262943688*^9}, {3.528531302490932*^9, 3.528531423352598*^9}, {
   3.528531470841899*^9, 3.5285315053689337`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Os", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"3", ",", "2"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "4"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "3"}], "}"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.5285242072754507`*^9, 3.528524225892589*^9}, {
  3.528524667264082*^9, 3.5285246718830643`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.5285246729487867`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4", ",", "5"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2", ",", "3", ",", "4"}], "}"}]}], "}"}]], "Input",
 CellChangeTimes->{{3.528524664255615*^9, 3.528524664668614*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"emInit", "[", 
  RowBox[{"Os", ",", "3"}], "]"}]], "Input",
 CellChangeTimes->{{3.528524818858629*^9, 3.528524827251526*^9}, {
   3.528524861893128*^9, 3.528524885019393*^9}, {3.528524959642632*^9, 
   3.528524975272694*^9}, {3.528525029680509*^9, 3.528525067837976*^9}, 
   3.528526373628721*^9, {3.528527174289896*^9, 3.528527185173688*^9}, {
   3.5285279004076653`*^9, 3.528527912092656*^9}, {3.528528116488613*^9, 
   3.5285281186784143`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "0.6909776309781466`", ",", "0.2217294878726884`", ",", 
     "0.08729288114916496`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0.5020534770539196`", ",", "0.08385782562487025`", ",", 
       "0.4140886973212101`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0.6468310299088592`", ",", "0.12405005134445761`", ",", 
       "0.22911891874668314`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "0.5673562717117157`", ",", "0.40885298023904904`", ",", 
       "0.023790748049235283`"}], "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"2.1004500599451275`", ",", "0.9014973884260116`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1.3634676534049408`", ",", "0.3115280369140967`"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1.5122946762779599`", ",", "0.1614039632158364`"}], "}"}]}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.43084857883322253`", ",", "0.2776642674859352`"}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"0.2776642674859352`", ",", "0.3339086560788684`"}], "}"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1.3294619534752576`", ",", "0.8807190577048498`"}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"0.8807190577048498`", ",", "0.8246077023671253`"}], "}"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0.41542836862344695`", ",", "0.686200888753635`"}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"0.686200888753635`", ",", "1.1907218682553242`"}], "}"}]}], 
      "}"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.52852794438693*^9, 3.528528021223678*^9, 3.528528056697486*^9, {
   3.528528097395666*^9, 3.528528119278207*^9}, 3.528528253451503*^9, {
   3.5285283226758413`*^9, 3.528528348650609*^9}, 3.528528403753881*^9, 
   3.528528435041526*^9, 3.5285288613465223`*^9, 3.528528898987598*^9, 
   3.528529037832429*^9, 3.52852911873258*^9, 3.528529202774679*^9, 
   3.528529250998932*^9, {3.5285293015595493`*^9, 3.528529316907715*^9}, 
   3.528529451380178*^9, 3.528529566682952*^9, 3.528529722856841*^9, 
   3.528529912597937*^9, 3.528530014051609*^9, 3.52853041002194*^9, 
   3.5285304467604523`*^9, {3.5285306012968693`*^9, 3.528530664956216*^9}, 
   3.528530709222913*^9, 3.5285314414861298`*^9, {3.5285314826677437`*^9, 
   3.528531509080624*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"emStep", "[", "%", "]"}]], "Input",
 CellChangeTimes->{
  3.5285279364539547`*^9, {3.528528036741041*^9, 3.52852804060813*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DiagonalMatrix", "::", "vector"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Argument \[NoBreak]\\!\\({}\\)\[NoBreak] at position \
\[NoBreak]\\!\\(1\\)\[NoBreak] is not a non-empty vector. \\!\\(\\*ButtonBox[\
\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/vector\\\", ButtonNote -> \
\\\"DiagonalMatrix::vector\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540457039*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DiagonalMatrix", "::", "vector"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Argument \[NoBreak]\\!\\({}\\)\[NoBreak] at position \
\[NoBreak]\\!\\(1\\)\[NoBreak] is not a non-empty vector. \\!\\(\\*ButtonBox[\
\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/vector\\\", ButtonNote -> \
\\\"DiagonalMatrix::vector\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540460837*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DiagonalMatrix", "::", "vector"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Argument \[NoBreak]\\!\\({}\\)\[NoBreak] at position \
\[NoBreak]\\!\\(1\\)\[NoBreak] is not a non-empty vector. \\!\\(\\*ButtonBox[\
\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/vector\\\", ButtonNote -> \
\\\"DiagonalMatrix::vector\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.5285315404628773`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"General", "::", "stop"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Further output of \
\[NoBreak]\\!\\(\\*StyleBox[\\(DiagonalMatrix :: vector\\), \\\"MessageName\\\
\"]\\)\[NoBreak] will be suppressed during this calculation. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/General/stop\\\", \
ButtonNote -> \\\"General::stop\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540464939*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Total", "::", "tllen"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Lists of unequal length in \
\[NoBreak]\\!\\(\\(\\({\\(\\({0.5020534770539196`, 0.08385782562487025`, \
0.4140886973212101`}\\)\\), \\(\\({0.6468310299088592`, 0.12405005134445761`, \
0.22911891874668314`}\\)\\), \\(\\({0.5673562717117157`, \
0.40885298023904904`, 0.023790748049235283`}\\)\\)}\\)\\) . \
\\(\\(DiagonalMatrix[\\(\\({}\\)\\)]\\)\\) . \\(\\({}\\)\\)\\)\[NoBreak] \
cannot be added. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\
\"Link\\\", ButtonFrame->None, ButtonData:>\\\"paclet:ref/Total\\\", \
ButtonNote -> \\\"Total::tllen\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540518585*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Power", "::", "infy"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Infinite expression \[NoBreak]\\!\\(1\\/0\\)\[NoBreak] \
encountered. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/infy\\\", ButtonNote -> \
\\\"Power::infy\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540520948*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Total", "::", "normal"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Nonatomic expression expected at position \
\[NoBreak]\\!\\(1\\)\[NoBreak] in \[NoBreak]\\!\\(Total[newPi$1680]\\)\
\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/normal\\\", ButtonNote -> \
\\\"Total::normal\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540586959*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Total", "::", "normal"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Nonatomic expression expected at position \
\[NoBreak]\\!\\(1\\)\[NoBreak] in \[NoBreak]\\!\\(Total[newPi$1680]\\)\
\[NoBreak]. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/normal\\\", ButtonNote -> \
\\\"Total::normal\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540589048*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Part", "::", "partw"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Part \[NoBreak]\\!\\(1\\)\[NoBreak] of \
\[NoBreak]\\!\\({}\\)\[NoBreak] does not exist. \\!\\(\\*ButtonBox[\\\"\
\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/partw\\\", ButtonNote -> \
\\\"Part::partw\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540592567*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Part", "::", "partw"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Part \[NoBreak]\\!\\(2\\)\[NoBreak] of \
\[NoBreak]\\!\\(DiagonalMatrix[\\(\\({}\\)\\)]\\)\[NoBreak] does not exist. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/General/partw\\\", \
ButtonNote -> \\\"Part::partw\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540597025*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"Part", "::", "partw"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Part \[NoBreak]\\!\\(3\\)\[NoBreak] of \
\[NoBreak]\\!\\(DiagonalMatrix[\\(\\({}\\)\\)]\\)\[NoBreak] does not exist. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, ButtonData:>\\\"paclet:ref/message/General/partw\\\", \
ButtonNote -> \\\"Part::partw\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.528531540598874*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"General", "::", "stop"}], "MessageName"], 
  RowBox[{
  ":", " "}], "\<\"Further output of \[NoBreak]\\!\\(\\*StyleBox[\\(Part :: \
partw\\), \\\"MessageName\\\"]\\)\[NoBreak] will be suppressed during this \
calculation. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/stop\\\", ButtonNote -> \
\\\"General::stop\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.5285315406007347`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"i", "*", "100"}], " ", "+", " ", 
     RowBox[{"j", "*", "10"}], " ", "+", " ", "k"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "10"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "10"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"k", ",", "10"}], "}"}]}], "]"}], " ", "//", " ", 
  "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.528529732963682*^9, 3.528529798080533*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.5285298128166943`*^9, 3.528529812856432*^9}}]
},
WindowSize->{1366, 744},
WindowMargins->{{67, Automatic}, {Automatic, 0}},
FrontEndVersion->"8.0 for Linux x86 (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 5389, 139, 446, "Code"],
Cell[CellGroupData[{
Cell[5971, 163, 692, 13, 30, "Input"],
Cell[6666, 178, 1495, 33, 30, "Output"]
}, Open  ]],
Cell[8176, 214, 28788, 660, 2251, "Code"],
Cell[CellGroupData[{
Cell[36989, 878, 389, 11, 30, "Input"],
Cell[37381, 891, 274, 9, 30, "Output"]
}, Open  ]],
Cell[37670, 903, 315, 9, 30, InheritFromParent],
Cell[CellGroupData[{
Cell[38010, 916, 471, 8, 30, "Input"],
Cell[38484, 926, 2825, 75, 69, "Output"]
}, Open  ]],
Cell[41324, 1004, 151, 3, 30, InheritFromParent],
Cell[41478, 1009, 512, 10, 24, "Message"],
Cell[41993, 1021, 512, 10, 24, "Message"],
Cell[42508, 1033, 514, 10, 24, "Message"],
Cell[43025, 1045, 539, 11, 24, "Message"],
Cell[43567, 1058, 757, 14, 24, "Message"],
Cell[44327, 1074, 445, 10, 49, "Message"],
Cell[44775, 1086, 509, 11, 24, "Message"],
Cell[45287, 1099, 509, 11, 24, "Message"],
Cell[45799, 1112, 465, 10, 24, "Message"],
Cell[46267, 1124, 493, 10, 24, "Message"],
Cell[46763, 1136, 493, 10, 24, "Message"],
Cell[47259, 1148, 530, 11, 24, "Message"],
Cell[47792, 1161, 480, 14, 30, "Input"],
Cell[48275, 1177, 94, 1, 30, InheritFromParent]
}
]
*)

(* End of internal cache information *)
